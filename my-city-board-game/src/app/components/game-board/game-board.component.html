<div class="main-container">
  <div class="placement-status">
    <h3>{{ getCurrentPlacementText() }}</h3>
  </div>
  <div class="board-wrapper"
       [class.prep-phase]="inPreparationPhase()"
       [class.bonus-phase]="inBonusStage()"
       [class.regular-phase]="!inPreparationPhase() && !inBonusStage()">
    <!-- Empty corner cell -->
    <div class="label-corner"></div>

    <!-- Column labels (top) -->
    @for (colLabel of colLabels; track $index) {
      <div class="label-col">{{ colLabel }}</div>
    }

    <!-- Row labels and cells -->
    @for (row of board(); track $rowIndex; let $rowIndex = $index) {
      <!-- Row label (left) -->
      <div class="label-row" 
           [class.scoring-street]="isRowScoringStreet($rowIndex)"
           [class.row-selectable]="placementState() === 'row_selection'"
           (click)="placementState() === 'row_selection' ? selectScoringRow($rowIndex) : null">
        {{ rowLabels[$rowIndex] }}
      </div>

      <!-- Cells for this row -->
      @for (cell of row; track $colIndex; let $colIndex = $index) {
        <div
          class="cell"
          [class.disabled]="!currentRolls() || currentRolls()?.length !== 2"
          [class.clickable]="isCellClickable($rowIndex, $colIndex) || placementState() === 'row_selection'"
          [class.not-allowed]="
            currentRolls() &&
            currentRolls()?.length === 2 &&
            !isCellClickable($rowIndex, $colIndex) &&
            !isCellOccupied($rowIndex, $colIndex) &&
            placementState() !== 'row_selection'
          "
          [class.occupied]="isCellOccupied($rowIndex, $colIndex)"
          [class.scoring-street]="isRowScoringStreet($rowIndex)"
          [class.scoring-group]="isCellInScoringGroup($rowIndex, $colIndex)"
          [class.row-selectable]="placementState() === 'row_selection'"
          [class.plaza-bonus]="isCellPlazaBonus($rowIndex, $colIndex)"
          [class.adjacent-to-plaza-bonus]="isCellAdjacentToPlazaBonus($rowIndex, $colIndex)"
          (click)="handleCellClick($rowIndex, $colIndex)"
        >
          @if (getCellPoints($rowIndex, $colIndex) > 0) {
            <div class="cell-points">{{ getCellPoints($rowIndex, $colIndex) }}</div>
          }
          @if (cell) {
            <lucide-icon [name]="cell" />
          }
        </div>
      }
    }
  </div>
  
  <!-- Game Footer Component -->
  <app-game-footer 
    [footerScores]="footerScores()"
    [currentRound]="currentRound()"
    [bonusStageRounds]="bonusStageRounds"
    [bonusStageBuildings]="bonusStageBuildings()"
    [totalScore]="getTotalScore()">
  </app-game-footer>
  
  <!-- Scoreboard when game is complete -->
  @if (gameComplete()) {
    <app-scoreboard
      [footerScores]="footerScores()"
      [bonusStageRounds]="bonusStageRounds"
      [plazaBonus]="getPlazaBonus()"
      (playAgain)="playAgain.emit()">
    </app-scoreboard>
  }
</div>
